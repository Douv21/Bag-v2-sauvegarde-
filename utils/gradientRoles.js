/**
 * R√îLES UNIQUES AVEC D√âGRAD√âS ET STYLES AVANC√âS
 * Collection de r√¥les avec des couleurs d√©grad√©es et des designs uniques
 */

const gradientRoles = {
    premium: {
        name: 'üíé R√¥les Premium',
        description: 'R√¥les exclusifs avec des d√©grad√©s uniques',
        exclusive: true,
        roles: [
            {
                name: 'Sunset Royalty',
                emoji: 'üëë',
                color: '#FF6B35', // Orange-rouge principal
                gradientColors: ['#FF6B35', '#F7931E', '#FFD700'], // Sunset gradient
                description: 'Majestueux comme un coucher de soleil royal',
                style: 'premium',
                rarity: 'legendary'
            },
            {
                name: 'Ocean Depths',
                emoji: 'üåä',
                color: '#1e3c72', // Bleu oc√©an profond
                gradientColors: ['#1e3c72', '#2a5298', '#74b9ff'], // Oc√©an profond vers surface
                description: 'Myst√©rieux comme les profondeurs oc√©aniques',
                style: 'premium',
                rarity: 'legendary'
            },
            {
                name: 'Aurora Borealis',
                emoji: 'üåå',
                color: '#667eea', // Violet-bleu principal
                gradientColors: ['#667eea', '#764ba2', '#f093fb'], // Aurore bor√©ale
                description: 'Magique comme les aurores bor√©ales',
                style: 'premium',
                rarity: 'legendary'
            },
            {
                name: 'Neon Cyberpunk',
                emoji: '‚ö°',
                color: '#ff0080', // Rose n√©on
                gradientColors: ['#ff0080', '#ff8c00', '#00ff41'], // Cyberpunk n√©on
                description: 'Futuriste et √©lectrisant',
                style: 'premium',
                rarity: 'epic'
            },
            {
                name: 'Golden Phoenix',
                emoji: 'üî•',
                color: '#f12711', // Rouge feu
                gradientColors: ['#f12711', '#f5af19', '#ffd700'], // Feu vers or
                description: 'Rena√Æt de ses cendres en or pur',
                style: 'premium',
                rarity: 'legendary'
            },
            {
                name: 'Cosmic Nebula',
                emoji: 'üåü',
                color: '#8e2de2', // Violet cosmique
                gradientColors: ['#8e2de2', '#4a00e0', '#ff006e'], // N√©buleuse cosmique
                description: 'N√© des √©toiles et de la poussi√®re cosmique',
                style: 'premium',
                rarity: 'legendary'
            }
        ]
    },

    elements: {
        name: 'üåü √âl√©ments Mystiques',
        description: 'Ma√Ætrisez les forces √©l√©mentaires',
        exclusive: true,
        roles: [
            {
                name: 'Fire Master',
                emoji: 'üî•',
                color: '#ff4757', // Rouge feu intense
                gradientColors: ['#ff3838', '#ff4757', '#ff6348'], // Flammes ardentes
                description: 'Ma√Ætre des flammes √©ternelles',
                style: 'elemental',
                rarity: 'epic'
            },
            {
                name: 'Ice Sovereign',
                emoji: '‚ùÑÔ∏è',
                color: '#3742fa', // Bleu glace
                gradientColors: ['#70a1ff', '#3742fa', '#2f3542'], // Glace cristalline
                description: 'Souverain des terres gel√©es',
                style: 'elemental',
                rarity: 'epic'
            },
            {
                name: 'Storm Caller',
                emoji: '‚ö°',
                color: '#2ed573', // Vert √©lectrique
                gradientColors: ['#7bed9f', '#2ed573', '#1e90ff'], // Orage √©lectrique
                description: 'Invoque les temp√™tes et la foudre',
                style: 'elemental',
                rarity: 'epic'
            },
            {
                name: 'Earth Guardian',
                emoji: 'üóø',
                color: '#8b4513', // Brun terre
                gradientColors: ['#d2691e', '#8b4513', '#228b22'], // Terre fertile
                description: 'Protecteur de la nature sauvage',
                style: 'elemental',
                rarity: 'epic'
            },
            {
                name: 'Void Walker',
                emoji: 'üåë',
                color: '#2c2c54', // Noir cosmique
                gradientColors: ['#40407a', '#2c2c54', '#000000'], // Vide intersid√©ral
                description: 'Marche entre les dimensions',
                style: 'elemental',
                rarity: 'legendary'
            }
        ]
    },

    cosmic: {
        name: 'üåå Entit√©s Cosmiques',
        description: 'Beings from beyond the stars',
        exclusive: true,
        roles: [
            {
                name: 'Stellar Architect',
                emoji: '‚≠ê',
                color: '#ffd700', // Or stellaire
                gradientColors: ['#fff700', '#ffd700', '#ff8c00'], // √âtoile dor√©e
                description: 'Architecte des constellations',
                style: 'cosmic',
                rarity: 'legendary'
            },
            {
                name: 'Galactic Emperor',
                emoji: 'üëë',
                color: '#9c27b0', // Violet imp√©rial
                gradientColors: ['#e91e63', '#9c27b0', '#673ab7'], // Majest√© galactique
                description: 'R√®gne sur des galaxies enti√®res',
                style: 'cosmic',
                rarity: 'mythic'
            },
            {
                name: 'Quantum Sage',
                emoji: 'üîÆ',
                color: '#00bcd4', // Cyan quantique
                gradientColors: ['#4fc3f7', '#00bcd4', '#009688'], // √ânergie quantique
                description: 'Ma√Ætre des lois quantiques',
                style: 'cosmic',
                rarity: 'legendary'
            },
            {
                name: 'Time Weaver',
                emoji: '‚è≥',
                color: '#795548', // Bronze temporel
                gradientColors: ['#bcaaa4', '#795548', '#3e2723'], // Flux temporel
                description: 'Tisse les fils du temps',
                style: 'cosmic',
                rarity: 'mythic'
            }
        ]
    },

    neon: {
        name: 'üí´ Neon Dreams',
        description: 'R√¥les aux couleurs n√©on vibrantes',
        exclusive: false,
        roles: [
            {
                name: 'Neon Pink',
                emoji: 'üíñ',
                color: '#ff1493', // Rose n√©on
                gradientColors: ['#ff69b4', '#ff1493', '#dc143c'], // Rose √©lectrique
                description: 'Vibrant comme les n√©ons de Tokyo',
                style: 'neon',
                rarity: 'rare'
            },
            {
                name: 'Electric Blue',
                emoji: '‚ö°',
                color: '#00ffff', // Cyan √©lectrique
                gradientColors: ['#87ceeb', '#00ffff', '#0000ff'], // Bleu √©lectrique
                description: '√âlectrisant comme un √©clair',
                style: 'neon',
                rarity: 'rare'
            },
            {
                name: 'Laser Green',
                emoji: 'üíö',
                color: '#00ff00', // Vert laser
                gradientColors: ['#7fff00', '#00ff00', '#32cd32'], // Vert laser
                description: 'Pr√©cis comme un rayon laser',
                style: 'neon',
                rarity: 'rare'
            },
            {
                name: 'Plasma Purple',
                emoji: 'üîÆ',
                color: '#8a2be2', // Violet plasma
                gradientColors: ['#da70d6', '#8a2be2', '#4b0082'], // Plasma violet
                description: '√ânergique comme le plasma',
                style: 'neon',
                rarity: 'rare'
            }
        ]
    },

    nature: {
        name: 'üåø Forces Naturelles',
        description: 'Connect√© aux √©nergies de la nature',
        exclusive: false,
        roles: [
            {
                name: 'Forest Spirit',
                emoji: 'üå≤',
                color: '#228b22', // Vert for√™t
                gradientColors: ['#90ee90', '#228b22', '#006400'], // For√™t profonde
                description: 'Esprit gardien de la for√™t ancienne',
                style: 'nature',
                rarity: 'epic'
            },
            {
                name: 'Mountain Peak',
                emoji: 'üèîÔ∏è',
                color: '#708090', // Gris montagne
                gradientColors: ['#f5f5f5', '#708090', '#2f4f4f'], // Sommet enneig√©
                description: 'In√©branlable comme les sommets',
                style: 'nature',
                rarity: 'epic'
            },
            {
                name: 'Desert Mirage',
                emoji: 'üèúÔ∏è',
                color: '#daa520', // Or d√©sert
                gradientColors: ['#f4a460', '#daa520', '#cd853f'], // Sables dor√©s
                description: 'Myst√©rieux comme un mirage',
                style: 'nature',
                rarity: 'rare'
            },
            {
                name: 'Ocean Tide',
                emoji: 'üåä',
                color: '#4682b4', // Bleu oc√©an
                gradientColors: ['#87ceeb', '#4682b4', '#191970'], // Mar√©es oc√©aniques
                description: 'Fluide comme les mar√©es',
                style: 'nature',
                rarity: 'rare'
            }
        ]
    },

    mythical: {
        name: 'üêâ Cr√©atures Mythiques',
        description: 'Incarnez des cr√©atures l√©gendaires',
        exclusive: true,
        roles: [
            {
                name: 'Dragon Lord',
                emoji: 'üêâ',
                color: '#8b0000', // Rouge dragon
                gradientColors: ['#ff4500', '#8b0000', '#000000'], // Flammes de dragon
                description: 'Seigneur des dragons ancestraux',
                style: 'mythical',
                rarity: 'mythic'
            },
            {
                name: 'Phoenix Rising',
                emoji: 'üî•',
                color: '#ff6347', // Orange phoenix
                gradientColors: ['#ffd700', '#ff6347', '#8b0000'], // Renaissance du phoenix
                description: 'Rena√Æt √©ternellement de ses cendres',
                style: 'mythical',
                rarity: 'mythic'
            },
            {
                name: 'Unicorn Grace',
                emoji: 'ü¶Ñ',
                color: '#dda0dd', // Violet licorne
                gradientColors: ['#ffffff', '#dda0dd', '#9370db'], // Puret√© magique
                description: 'Gr√¢ce pure et magie ancestrale',
                style: 'mythical',
                rarity: 'legendary'
            },
            {
                name: 'Kraken Depths',
                emoji: 'üêô',
                color: '#2f4f4f', // Vert-gris kraken
                gradientColors: ['#008080', '#2f4f4f', '#000080'], // Profondeurs abyssales
                description: 'Ma√Ætre des abysses oc√©aniques',
                style: 'mythical',
                rarity: 'legendary'
            }
        ]
    }
};

/**
 * G√©n√®re un nom de r√¥le avec des caract√®res Unicode sp√©ciaux
 */
function generateStyledRoleName(roleData) {
    const styles = {
        premium: (name) => `‚ú¶ ${name} ‚ú¶`,
        elemental: (name) => `‚óÜ ${name} ‚óÜ`,
        cosmic: (name) => `‚üê ${name} ‚üê`,
        neon: (name) => `‚óä ${name} ‚óä`,
        nature: (name) => `‚ùã ${name} ‚ùã`,
        mythical: (name) => `‚ü¢ ${name} ‚ü£`
    };

    const rarityPrefix = {
        'mythic': '‚öúÔ∏è',
        'legendary': 'üåü',
        'epic': 'üíé',
        'rare': '‚ú®',
        'common': '‚ö™'
    };

    const prefix = rarityPrefix[roleData.rarity] || '';
    const styledName = styles[roleData.style] ? styles[roleData.style](roleData.name) : roleData.name;
    
    return `${prefix} ${styledName}`.trim();
}

/**
 * Obtient la couleur principale d'un d√©grad√©
 */
function getPrimaryGradientColor(gradientColors) {
    // Retourne la couleur du milieu du d√©grad√©
    const middleIndex = Math.floor(gradientColors.length / 2);
    return gradientColors[middleIndex];
}

/**
 * Cr√©e une description enrichie avec des √©mojis et du style
 */
function generateEnrichedDescription(roleData) {
    const rarityDescriptions = {
        'mythic': 'üèÜ **MYTHIQUE** - Extr√™mement rare et puissant',
        'legendary': 'üåü **L√âGENDAIRE** - Rare et prestigieux',
        'epic': 'üíé **√âPIQUE** - Remarquable et distinctif',
        'rare': '‚ú® **RARE** - Sp√©cial et recherch√©',
        'common': '‚ö™ **COMMUN** - Accessible √† tous'
    };

    const gradientInfo = roleData.gradientColors ? 
        `\nüé® **D√©grad√©:** ${roleData.gradientColors.join(' ‚Üí ')}` : '';

    return `${roleData.description}\n\n${rarityDescriptions[roleData.rarity] || ''}${gradientInfo}`;
}

/**
 * Cr√©e tous les r√¥les d√©grad√©s pour une guilde
 */
async function createGradientRoles(guild, roleManager) {
    console.log(`üåà Cr√©ation des r√¥les d√©grad√©s pour ${guild.name}...`);
    
    const results = {
        success: 0,
        errors: 0,
        details: [],
        categories: 0
    };

    for (const [categoryId, categoryData] of Object.entries(gradientRoles)) {
        try {
            // Cr√©er la cat√©gorie
            roleManager.createCategory(guild.id, categoryId, {
                name: categoryData.name,
                description: categoryData.description,
                exclusive: categoryData.exclusive
            });
            results.categories++;

            // Cr√©er les r√¥les de la cat√©gorie
            for (const roleData of categoryData.roles) {
                try {
                    const styledName = generateStyledRoleName(roleData);
                    const primaryColor = roleData.gradientColors ? 
                        getPrimaryGradientColor(roleData.gradientColors) : 
                        roleData.color;
                    const enrichedDescription = generateEnrichedDescription(roleData);

                    const result = await roleManager.createCustomRole(guild, {
                        name: styledName,
                        emoji: roleData.emoji,
                        color: primaryColor,
                        description: enrichedDescription,
                        category: categoryId,
                        mentionable: false,
                        // Donn√©es √©tendues pour les d√©grad√©s
                        gradientColors: roleData.gradientColors,
                        style: roleData.style,
                        rarity: roleData.rarity
                    });

                    if (result.success) {
                        results.success++;
                        results.details.push(`‚úÖ ${roleData.emoji} ${styledName} (${roleData.rarity})`);
                    } else {
                        results.errors++;
                        results.details.push(`‚ùå ${roleData.name}: ${result.error}`);
                    }

                    // D√©lai pour √©viter les limites de taux
                    await new Promise(resolve => setTimeout(resolve, 150));
                } catch (error) {
                    results.errors++;
                    results.details.push(`‚ùå ${roleData.name}: ${error.message}`);
                }
            }
        } catch (error) {
            console.error(`Erreur cr√©ation cat√©gorie ${categoryId}:`, error);
        }
    }

    console.log(`üåà Cr√©ation termin√©e: ${results.success} r√¥les, ${results.categories} cat√©gories`);
    return results;
}

/**
 * Obtient la liste des r√¥les d√©grad√©s pour affichage
 */
function getGradientRolesList() {
    const list = [];
    
    for (const [categoryId, categoryData] of Object.entries(gradientRoles)) {
        list.push(`\n**${categoryData.name}**`);
        list.push(`*${categoryData.description}*`);
        
        // Grouper par raret√©
        const rolesByRarity = {};
        categoryData.roles.forEach(role => {
            if (!rolesByRarity[role.rarity]) {
                rolesByRarity[role.rarity] = [];
            }
            rolesByRarity[role.rarity].push(role);
        });

        // Afficher par ordre de raret√©
        const rarityOrder = ['mythic', 'legendary', 'epic', 'rare', 'common'];
        for (const rarity of rarityOrder) {
            if (rolesByRarity[rarity]) {
                for (const role of rolesByRarity[rarity].slice(0, 2)) {
                    const styledName = generateStyledRoleName(role);
                    list.push(`${role.emoji} ${styledName}`);
                }
                if (rolesByRarity[rarity].length > 2) {
                    list.push(`... et ${rolesByRarity[rarity].length - 2} autres ${rarity}`);
                }
            }
        }
    }
    
    return list.join('\n');
}

/**
 * Obtient les statistiques des r√¥les d√©grad√©s
 */
function getGradientRolesStats() {
    let totalRoles = 0;
    let totalCategories = 0;
    const rarityCount = {};
    const styleCount = {};

    for (const [categoryId, categoryData] of Object.entries(gradientRoles)) {
        totalCategories++;
        totalRoles += categoryData.roles.length;

        categoryData.roles.forEach(role => {
            rarityCount[role.rarity] = (rarityCount[role.rarity] || 0) + 1;
            styleCount[role.style] = (styleCount[role.style] || 0) + 1;
        });
    }

    return {
        totalRoles,
        totalCategories,
        rarityCount,
        styleCount
    };
}

module.exports = {
    gradientRoles,
    createGradientRoles,
    getGradientRolesList,
    getGradientRolesStats,
    generateStyledRoleName,
    generateEnrichedDescription,
    getPrimaryGradientColor
};